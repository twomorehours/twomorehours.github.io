---
title: 代理和LVS
date: 2020-05-10 21:30:39
categories:
- 网络
tags:
- 正向代理
- 反向代理
---

## 正向代理
- 概念
    - 代理客户端发送请求
- 用途
    - 代理浏览器访问
    - 缓存访问资源
    - 客户端访问授权（限制访问资源）
    - 上网行为管理
    - 隐藏用户信息

## 反向代理
- 概念
    - 代理服务端接收请求
- 作用
    - 解决单机处理能力不足的问题，多台负载均衡
    - 保证内网安全（代理做安全加固）
    - 缓存web请求
    - 代理隐藏目标
- 种类
    - 硬件
        - F5：太贵
    - 软件
        - LVS

## 什么是LVS
- 概念
    - LVS是工作在四层的反向代理组件， 不涉及业务逻辑，只负责流量分发
- 组成
    - ipvs 
        - 实现调度
    ipvsadmin 
        - 后台配置
- 名词解释                
    - DS：Direct Server 负载均衡器
    - RS：Real Server 被代理的server
    - VIP：虚IP 直接面向IP
    - DIP：DS用于和RS通信的IP
    - RIP：RS的IP
    - CIP：客户端的IP

- 工作模式
    - DR: 常用 但是DS必须可以和RS用MAC地址通信
        - LVS将请求包MAC地址修改为RS的MAC地址，CIP保持不变 
        - RS处理完之后直接返回给CIP，RS感知不到LVS的存在
    - TUN（隧道） 不常用，通过四层转发，用于DS和RS不能用MAC地址通信的情况
        - LVS将请求添加上DIP到RIP
        - RS处理完之后直接返回给CIP
    - NAT/NAT-FULL：不常用 两次转发，LVS有性能瓶颈
        - LVS是性能瓶颈
        - LVS将目的地址转为DIP->RIP
        - RIP处理完之后反给LVS
        - LVS再把目标替换为VIP->CIP

- 负载算法
    - 轮询
    - 权重轮询
    - 最小连接
    - 权重最小连接 
    -     最小连接1/权重1 <>  最小连接2/权重2 
    -     最小连接1 * 权重2 <>  最小连接2 * 权重1
    - 目标地址散列
    - 源地址散列

- 特点
    - 高性能
    - 省资源
    - 高可靠
    - 配置少 容易上手
