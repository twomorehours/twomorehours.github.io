---
title: 类加载
date: 2020-04-17 15:29:26
categories: 
- JVM

---

## class信息

![image-20200304071455336](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/类文件字节码结构组织示意图.png)



## 类加载过程

1. 加载
   - 通过类的全路径获取该类的二进制字节流
   - 将字节流中的静态字段装为方法区中的运行时数据结构
   - 在内存中创建该类的Class对象,作为访问该类的入口
2. 连接
   - 验证:验证class对应的字节码是否符合规范
   - 准备:为变量(static)分配内存空间,比初始化值为默认值
   - 解析:符号引用变为之间引用
3. 初始化:对类进行初始化 每个类只能初始化一次(类的class对象中维护类是否init了每次加锁的方式来初始化),初始化的时机如下:
   - new 对象实例
   - 访问静态变量
   - 静态变量赋值
   - 访问静态方法



## 类加载器

1. 启动类加载(bootstrapClassLoader):加载java_home/lib包下的jar和类
2. 扩展加载器(ExtensionClassLoader):加载java_home/lib/ext下
3. 应用程序加载器(AppClassLoader):加载用户classpath下的jar和类



## 双亲委派

![image-20200304071455336](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/classloader_WPS图片.png)

1. 当类加载时,首先检查当前类是否被加载过,加载过直接返回
2. 未加载过,则交给父类加载器调用loadClass,父类加载器在判断自己的父类是否加载过,未加载过在交给自己的父类一层一层最后到bootstrapClassLoader
3. 从顶层的加载器从上往下进行加载
4. 好处:避免类的加载重复