---
title: 不停服务拆分一张表
date: 2020-06-15 21:30:39
categories:
- 程序设计
---

## 双写
- 新建一个dao,这个dao封装了分表的CURD逻辑
- service写入数据时同时向两个dao写入数据
  - 老表保留全量数据，以便进行错误处理
- 上线


## 同步数据
- 编写一个任务
- 取老表最新一条数据
  - 这条数据(不包含这条)之后的数据一定在新表中存在，因为上面已经开启了双写
- 同步老表自第一条数据到这条数据到新分表中
  - 可能会遇到重复，跳过即可
- 如果同步过程中出现了错误，处理错误后把新表drop掉重新同步即可
  - 这里取出当前最新的一条数据(非之前取出的数据)，并把这条数据当做新的基准

## 下线老表
- 将代码中对老表CRUD下掉
- 上线