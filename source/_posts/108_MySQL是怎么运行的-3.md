---
title: InnoDB的索引实现
date: 2020-03-18 23:30:39
categories:
- MySQL
tags:
- InnoDB
- B+树
---

## B+树的结构
- 根节点
  - 根节点一旦创建就不会移动，始终页号不变
- 非叶子节点
  - 非叶子不存储真实的记录数据，只存储目录项，非叶子节点就是B+树的树干，同层不同节点使用双向链表连接
- 叶子节点
  - 叶子节点存储真实的记录数据，不同节点之间使用双向链表连接


## 索引分类
- 聚集索引
  - 聚集索引是主键索引，叶子节点存储的是真实的记录数据
- 二级索引
  - 二级索引是以指定字段顺序构建B+树，叶子节点存储的是主键的值，这样可以节省空间
- 联合索引
  - 联合索引是一种特殊的二级索引，是由多个字段组合而成的索引，生成一个B+树，排序优先级由钱到后依次降低，使用联合索引时要满足左前缀原则，当前缀不相同时会定位到不同的数据范围，不同的数据范围内的后面的索引也不一定是有序的

## 索引的查询流程
先定位页，再定位数据
- 从根节点的slot二分查找，找到所属的组，然后从组内找到最后一个小于这个值的节点，根据页号调到下一层节点
- 重复上述步骤，一直到叶子节点
- 从叶子节点的slot查找，找到所属的组，然后遍历这个组内的值，找到匹配或者不匹配的

## 没有索引的查询流程
没有索引定位不到具体的数据范围，只能从叶子节点的第一页开始逐页逐条数据遍历，找到符合的