---
title: 分布式系统技术点
date: 2020-04-07 21:30:39
categories:
- 分布式
---

## 高可用设计
- DNS 
  - 域名解析成IP
  - DNS提供商实现高可用
- CDN 
  - 静态文件的加速，没有数据的则回源
  - CDN提供商实现高可用
- LVS
  - 完成四层负载
  - KeepAlived 主备部署高可用
  - 性能极高
- Nginx 
  - 七层HTTP负载
  - 集群部署实现高可用
- gateway
  - 微服务网关
  - 实现统一鉴权日志等功能
  - 集群部署实现高可用
- 微服务
  - 无状态部署，实现业务逻辑
  - 集群部署
      - 实现高可用
  - 集群部署的要关注的技术点
    - 服务注册发现
    - 连接管理
    - 负载均衡
    - 节点探活
    - 失效处理
    
- 存储
    - 主从部署，读写分离
      - 一主一从
      - 一主多从
      - 延时从 
        - 利用延时从恢复被误操作的数据
    - 主从切换
      - 主库挂了之后 从库直接提升为主库 主库恢复之后 主库再恢复过来
      - 新主库预热问题
        - 内存没有热数据：控制入口流量
      - 业务无感知
            使用虚IP
    - 数据隔离
            不同业务模块使用不同数据库实例
- 模块拆分
  - 网关 + 按照业务垂直拆分
  - 拆分原则
    - 职责单一，业务隔离，粒度合理

## 高性能设计
- CDN
  - 边缘节点加速
- 业务逻辑优化
  - 使用合适的数据结构
  - 非必要耗时逻辑异步处理
- 部署优化
  - 使用合理JVM参数
  - 增加节点部署
- 存储性能优化
  - 使用缓存
    - 读多写少
    - cache aside
  - DB索引优化
  - 分库分表
    - 字段相关：取模
    - 其他字走映射表，比如手机号
    - 如果都是两个id都是自己生成 可以使用基因法 即两个id用于分表的bit保持一致，如商品发布逻辑，商品也分表，查询用户发布的所有商品
    - 冷热数据
      - 可以采用定时归档的措施
    - 时间相关
      - 按时间范围拆分 
        - 比如订单流水数据（不区分用户的）

## 服务治理
- 过载保护
  - 服务方超时丢弃
- 熔断降级
  - 返回失败降级
  - 调用方超时降级
  - 达到阈值熔断降级  
- 权重支持
  - 考虑到节点的性能差异
- 日常维护
  - 监控
    - 发现系统异常
    - 平均响应、TP99、TP95
- 调用链
  - 查找问题方便