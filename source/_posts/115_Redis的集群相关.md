---
title: Redis的集群
date: 2020-07-27 23:30:39
categories:
- Redis
---

## Redis的主从复制
- 初始复制
  - 初始复制是指从节点第一上线，之前没有接受任何的数据
  - 从节点给主节点发送psync同步请求
  - 主节点灰度fullresync响应，并返回主节点的id
  - 主机节点使用bgsave dump出rdb快照， 推送给从节点，并保存在这个期间生成的写日志
  - 从节点接受rdb全量恢复数据
  - 主节点给从节点推送这个过程中发生的写请求
  - 进入正常状态，主节点会持续把写请求推给从节点，并记录在一个环形数组的buffer中
- 断点复制
  - 断点复制是指从节点不是刚上线而是因为网络原因断线了
  - 这种情况下丛节点发送psync会携带上次的offset
  - 如果这个offset在环形数组中还存在就同步剩余的数据过去，如果不存在就和初始复制一样走全量